package com.project.artists.entity;

import jakarta.persistence.*;
import jakarta.validation.constraints.NotBlank;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.JdbcTypeCode;
import org.hibernate.annotations.UpdateTimestamp;
import org.hibernate.type.SqlTypes;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

/**
 * Entidade Album
 * Relacionamento N:N com Artist (um álbum pode ter vários artistas)
 */
@Entity
@Table(name = "albums")
public class Album {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank(message = "Título do álbum é obrigatório")
    @Column(nullable = false, length = 200)
    private String title;
    
    /**
     * RELACIONAMENTO N:N COM ARTISTS
     * Um álbum pode ter múltiplos artistas (colaborações)
     * Um artista pode ter múltiplos álbuns
     */
    @ManyToMany(fetch = FetchType.LAZY)
    @JoinTable(
        name = "artist_album",
        joinColumns = @JoinColumn(name = "album_id"),
        inverseJoinColumns = @JoinColumn(name = "artist_id")
    )
    private Set<Artist> artists = new HashSet<>();
    
    @Column(name = "release_year")
    private Integer releaseYear;
    
    @JdbcTypeCode(SqlTypes.JSON)
    @Column(name = "cover_urls", columnDefinition = "jsonb")
    private List<String> coverUrls = new ArrayList<>();
    
    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;
    
    // Construtores
    public Album() {}
    
    public Album(String title, Integer releaseYear) {
        this.title = title;
        this.releaseYear = releaseYear;
    }
    
    // Métodos auxiliares para gerenciar relacionamento N:N
    public void addArtist(Artist artist) {
        this.artists.add(artist);
        artist.getAlbums().add(this);
    }
    
    public void removeArtist(Artist artist) {
        this.artists.remove(artist);
        artist.getAlbums().remove(this);
    }
    
    // Getters e Setters
    public Long getId() { 
        return id; 
    }
    
    public void setId(Long id) { 
        this.id = id; 
    }
    
    public String getTitle() { 
        return title; 
    }
    
    public void setTitle(String title) { 
        this.title = title; 
    }
    
    public Set<Artist> getArtists() { 
        return artists; 
    }
    
    public void setArtists(Set<Artist> artists) { 
        this.artists = artists; 
    }
    
    public Integer getReleaseYear() { 
        return releaseYear; 
    }
    
    public void setReleaseYear(Integer releaseYear) { 
        this.releaseYear = releaseYear; 
    }
    
    public List<String> getCoverUrls() { 
        return coverUrls; 
    }
    
    public void setCoverUrls(List<String> coverUrls) { 
        this.coverUrls = coverUrls; 
    }
    
    public LocalDateTime getCreatedAt() { 
        return createdAt; 
    }
    
    public LocalDateTime getUpdatedAt() { 
        return updatedAt; 
    }
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Album)) return false;
        Album album = (Album) o;
        return id != null && id.equals(album.getId());
    }
    
    @Override
    public int hashCode() {
        return getClass().hashCode();
    }
}
